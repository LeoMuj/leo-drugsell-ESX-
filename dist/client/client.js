"use strict";(()=>{var Delay=async ms=>{return new Promise(res=>{setTimeout(res,ms)})};var Config={drugs:[{name:"Marijuana",itemName:"marijuana",price:100},{name:"Meth",itemName:"meth",price:150}]};var drawText=(x,y,z,text)=>{SetTextScale(.27,.27);SetTextFont(4);SetTextProportional(true);SetTextColour(255,255,255,215);SetTextEntry("STRING");SetTextCentre(true);AddTextComponentString(text);SetDrawOrigin(x,y,z,0);DrawText(0,.002);DrawRect(0,0+.0125,.055,.02,0,0,0,75);ClearDrawOrigin()};var faceEatchOther=(player,ped2)=>{const[playerX,playerY,playerZ]=GetEntityCoords(player,false);SetEntityCoordsNoOffset(ped2,playerX+1.3,playerY,playerZ,true,true,true);const[pedX,pedY,pedZ]=GetEntityCoords(ped2,false);const direction=Math.atan2(pedY-playerY,pedX-playerX)*(180/Math.PI);SetEntityHeading(player,direction-90);SetEntityHeading(ped2,direction+90)};var playAnimation=async(player,dictionary,animation)=>{RequestAnimDict(dictionary);while(!HasAnimDictLoaded(dictionary)){await new Promise(resolve=>setTimeout(resolve,100))}TaskPlayAnim(player,dictionary,animation,8,-8,-1,0,0,false,false,false)};var startItemExchangeAnimation=async(player,ped2)=>{const animDictionary="mp_common";const animGiveItem="givetake2_a";const animReceiveItem="givetake2_a";playAnimation(player,animDictionary,animGiveItem);await new Promise(resolve=>setTimeout(resolve,100));playAnimation(ped2,animDictionary,animReceiveItem)};var loadObjectInHand=(player,modelHash)=>{const object=CreateObjectNoOffset(modelHash,0,0,0,true,true,false);AttachEntityToEntity(object,player,GetPedBoneIndex(player,57005),.15,0,0,300,270,60,true,true,false,true,1,true);setTimeout(()=>{DetachEntity(object,true,true);DeleteEntity(object)},1500)};var randomDrug=()=>{return Config.drugs[Math.floor(Math.random()*(Config.drugs.length-0)+0)]};var endScript=npc=>{const cam=CreateCam("DEFAULT_SCRIPTED_CAMERA",true);DestroyCam(cam,true);RenderScriptCams(false,false,0,true,false);SetNuiFocus(false,false);startItemExchangeAnimation(PlayerPedId(),npc);loadObjectInHand(PlayerPedId(),GetHashKey("prop_drug_package_02"));setTimeout(()=>{loadObjectInHand(PlayerPedId(),GetHashKey("prop_anim_cash_pile_01"))},1200);setTimeout(()=>{loadObjectInHand(npc,GetHashKey("prop_drug_package_02"));FreezeEntityPosition(npc,false)},1500)};var cancelDeal=ped2=>{const cam=CreateCam("DEFAULT_SCRIPTED_CAMERA",true);DestroyCam(cam,true);RenderScriptCams(false,false,0,true,false);SetNuiFocus(false,false);ClearPedTasks(ped2);FreezeEntityPosition(ped2,false)};var closeToPed=false;var interacting=false;var npcsSoldTo=[];var drugAmount=0;var drug=null;var pricePerG=0;var ped=0;RegisterNuiCallbackType("uiCallbacks");on("__cfx_nui:uiCallbacks",data=>{const callbackType=data.callbackType;if(callbackType==="drug confirmation"){if(!drug)return;interacting=false;closeToPed=false;npcsSoldTo.push(ped);if(data.acceptedOffer==="time"){global.exports["ui"].Notify(`You took to long to decide, the stranger walked away`,"error",3500,"Failed");cancelDeal(ped);return}if(data.acceptedOffer){global.exports["ui"].Notify(`You sold ${drugAmount}g of ${drug["name"]} for $${pricePerG*drugAmount}`,"success",3500,"Success");emitNet("processDeal",drugAmount,pricePerG*drugAmount,drug["itemName"]);endScript(ped)}else{cancelDeal(ped)}}});setTick(async()=>{!closeToPed&&await Delay(500);const[playerX,playerY,playerZ]=GetEntityCoords(PlayerPedId(),false);const[retval,outPed]=GetClosestPed(playerX,playerY,playerZ,2,true,false,false,false,1);if(retval&&DoesEntityExist(outPed)&&!interacting&&!npcsSoldTo.includes(outPed)){const[npcX,npcY,npcZ]=GetEntityCoords(outPed,false);drawText(npcX,npcY,npcZ,"Press ~b~[E] ~w~to interact");if(IsControlJustPressed(38,38)){if(!Math.round(Math.random())){TaskSmartFleePed(outPed,PlayerPedId(),1e4,-1,false,false);global.exports["ui"].Notify("The stranger called the police!","info",3500,"Police");return}const maxLength=1;const minLength=0;drugAmount=Math.floor(Math.random()*(maxLength-minLength+1)+1);ped=outPed;drug=randomDrug();pricePerG=drug["price"]-Math.floor(Math.random()*(50-20+1)+20);SendNUIMessage({type:"open",conversation:`Hel... Hello you got ${drugAmount}g of ${drug["name"]} for $${pricePerG*drugAmount}, please dude`,dealRate:pricePerG>=drug["price"]-25?"Good":pricePerG>=drug["price"]-40?"Medium":"Bad",sex:IsPedMale(outPed)?"male":"female"});faceEatchOther(PlayerPedId(),outPed);SetNuiFocus(true,true);const cam=CreateCam("DEFAULT_SCRIPTED_CAMERA",true);SetCamCoord(cam,npcX,npcY-1,npcZ+.5);RenderScriptCams(true,false,0,true,false);TaskStandStill(outPed,-1);SetEntityCoords(outPed,npcX,npcY,npcZ-1,true,false,false,false);SetEntityCoords(PlayerPedId(),npcX,npcY-1,npcZ-1,true,false,false,false);FreezeEntityPosition(outPed,true);SetEntityHeading(PlayerPedId(),360);SetEntityHeading(outPed,180);interacting=true;closeToPed=true;return}closeToPed=true;return}interacting=false;closeToPed=false});})();
